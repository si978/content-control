# 需求文档（模板，V1）

> 目的：你只需要维护这一份文档（以及后续的变更记录），AI 就能在每次任务开始前构建一致的上下文，并在 PR 门禁中被自动校验。

## 1. 背景 / 问题
- 你希望从一份简单需求出发，让 AI 完成开发、测试、上线全流程，并支持需求调整、重构等长期演进。
- 你的代码与文档规模会增长到：百份文档、十万行代码量级。
- 你希望：上下文由系统统一构建，不依赖单次聊天记录；多个 Agent 获得一致视角与约束。

## 2. 目标（Goals）
- 目标 1：把项目“长期记忆/约束/决策/流程”固化到仓库，可审计、可回滚。
- 目标 2：每个任务开始前生成确定性的 `context_pack.json`（同一 commit+task_id 可复算）。
- 目标 3：在 GitHub PR 中自动把关：记忆合法性、陈旧检测、上下文包可验证（可配置软/硬）。

## 3. 非目标（Non-goals）
- 不做向量库/外部数据库检索作为主事实源（可后续扩展，但不是 V1）。
- 不做自动 merge/自动发布（先以 PR+CI 门禁为主）。

## 4. 输入与产出
### 输入
- 需求文档：本文件（`docs/requirements.md`）
- 仓库事实：代码、测试、CI 配置、部署脚本等

### 产出（每次任务）
- 一条 `TASK-...`（目标/验收/范围/证据）
- 一个 `context_pack.json`（给 AI 的唯一资料包）
- 一次 PR（可审计的变更）

## 5. 约束与决策（长期有效）
> 这部分建议沉淀到 `.ai/memory/constraints/**` 与 `.ai/memory/adr/**`，避免只写在需求里。
- 代码托管：GitHub
- 代码质量：必须有自动化测试/检查（按项目情况逐步完善）

## 6. 验收标准（Success Criteria）
- 同一 `commit + task_id` 两次构建 `context_pack.json` 产物一致（确定性）。
- `validate-pack` 能证明 pack 没被篡改且可从 git 复算。
- PR 打 `ai` 标签时，门禁能自动判断：记忆是否合规、是否 stale、pack/（可选）agent_report 是否可复算。

## 7. 待补充（你只需要在这里粘贴/追加）
- 你的真实产品/系统要做什么（功能清单/用户故事/接口/数据模型）
- 运行环境与上线目标（云厂商/容器/域名/数据库/权限）
- 必须遵守的合规/安全要求

